<ng-container
  *ngIf="
    type.value === 'service' ||
      type.value === 'data-source' ||
      type.value === 'provider' ||
      type.value === 'data source';
    else elseTypeIcon
  "
>
  <div class="type-icon-holder {{ type.label }}" style="flex: 115px 0 0">
    <div
      class="type-icon"
      [ngStyle]="{
        'background-image': 'url(' + this.logoUrl + ')',
        width: '100%',
        height: '100%',
        'background-repeat': 'no-repeat',
        'background-size': 'auto',
        'background-position': 'top center',
        margin: '25px auto'
      }"
    ></div>
  </div>
</ng-container>

<ng-template #elseTypeIcon>
  <div class="type-icon-holder {{ type.label }}">
    <div class="type-icon"></div>
  </div>
</ng-template>
<div
  id="container"
  [ngClass]="type.value === 'bundle' ? 'bundle_container' : 'nobundle'"
>
  <ess-colored-tags
    [type]="type"
    [tags]="coloredTags"
    [q]="q$ | async"
    (activeFilter)="setActiveFilter($event.filter, $event.value)"
  ></ess-colored-tags>
  <div style="display: flex">
    <div
      style="display: flex"
      *ngIf="type.value === 'provider'; else defaultTypeValueTemplate"
    >
      <div style="display: flex; flex-direction: column">
        <ess-url-title
          [ngClass]="{ padding_for_provider: type.value === 'provider' }"
          [title]="title"
          [highlight]="highlightsreal['title'] ?? []"
          [url]="redirectService.internalUrl(validUrl, id, type.value, '')"
        >
        </ess-url-title>
        <ess-url-title
          *ngIf="type.value === 'provider'"
          [ngClass]="{ sub_title: type.value === 'provider' }"
          [title]="abbreviation"
          [highlight]="highlightsreal['abbreviation'] ?? []"
          [url]="redirectService.internalUrl(validUrl, id, type.value, '')"
          style="margin-bottom: -10px"
        >
        </ess-url-title>
      </div>
    </div>

    <ng-template #defaultTypeValueTemplate>
      <div style="display: flex; flex-direction: column">
        <ess-url-title
          [ngClass]="{ padding_for_provider: type.value === 'provider' }"
          [title]="title"
          [highlight]="highlightsreal['title'] ?? []"
          [url]="redirectUrl"
        >
        </ess-url-title>
      </div>
    </ng-template>
  </div>
  <div class="product-type-bar">
    <div class="product-type-details" *ngIf="type !== undefined">
      {{ _createDocumentTypeLabel(type.label, documentType) }}
    </div>
    <img
      *ngIf="accessRight !== undefined"
      [src]="_getAccessIcon(accessRight!)"
    />
    <img
      *ngIf="horizontal !== undefined && horizontal"
      src="/assets/horizontal-service.svg"
    />
  </div>
  <div *ngIf="type.value !== 'bundle'" class="usage">
    <span
      *ngIf="
        date !== undefined &&
        date !== '' &&
        type.value !== 'bundle' &&
        type.value !== 'provider'
      "
      class="statistic text-muted"
      ><img src="/assets/usage-date.svg" />
      <ng-container i18n>{{ date }}</ng-container></span
    >
    <span *ngIf="downloads !== undefined" class="statistic text-muted"
      ><img src="/assets/usage-downloads.svg" />
      <ng-container i18n>{{ downloads }} Downloads</ng-container></span
    >
    <span *ngIf="views !== undefined" class="statistic text-muted"
      ><img src="/assets/usage-views.svg" />
      <ng-container i18n>{{ views }} Views</ng-container></span
    >
    <span *ngIf="license !== undefined" class="statistic text-muted">
      <ng-container i18n>License: {{ _formatLicense(license!) }}</ng-container>
    </span>
    <ng-container *ngIf="languages.length > 0">
      <ng-container *ngIf="languages.length === 1; else elseBlock">
        <span class="statistic text-muted">
          <img src="/assets/language.svg" />
          <ng-container i18n>{{ languages[0] }}</ng-container>
        </span>
      </ng-container>
      <ng-template #elseBlock>
        <img src="/assets/language.svg" />
        <div ngbDropdown class="d-inline-block language-dropdown">
          <button
            type="button"
            class="btn statistic text-muted"
            id="languageDropdown"
            ngbDropdownToggle
          >
            <ng-container i18n> {{ languages.length }} languages</ng-container>
          </button>
          <div ngbDropdownMenu aria-labelledby="languageDropdown">
            <div
              *ngFor="let language of languages"
              class="statistic text-muted"
            >
              <ng-container i18n>{{ language }}</ng-container>
            </div>
          </div>
        </div>
      </ng-template>
    </ng-container>
  </div>
  <div *ngIf="type.value !== 'bundle'; else bundleBlock">
    <ess-tags
      [tags]="tags"
      [highlights]="highlightsreal"
      (activeFilter)="setActiveFilter($event.filter, $event.value)"
      [providerName]="providerName"
    >
    </ess-tags>
    <div style="border-bottom: 1px dotted #d9dee2; padding: 3px 0"></div>

    <ess-description
      [description]="description"
      [highlights]="highlightsreal['description'] ?? []"
    ></ess-description>
    <ess-ig-services-card
      *ngIf="type.value === 'guideline'"
      [relatedServices]="relatedServices"
      [title]="title"
    ></ess-ig-services-card>
  </div>
  <ng-template #bundleBlock>
    <ess-description
      [description]="description"
      [highlights]="highlightsreal['description'] ?? []"
    ></ess-description>
    <div style="border-bottom: 1px dotted #d9dee2; padding: 3px 0"></div>

    <ess-tags
      [tags]="tags"
      [highlights]="highlightsreal"
      (activeFilter)="setActiveFilter($event.filter, $event.value)"
    >
    </ess-tags>
  </ng-template>

  <ess-secondary-tags
    *ngIf="type.value !== 'bundle'"
    [highlights]="highlightsreal"
    [tags]="secondaryTags"
    (activeFilter)="setActiveFilter($event.filter, $event.value)"
  >
  </ess-secondary-tags>
  <div>
    <div>
      <div class="bundle-box" *ngIf="type.value === 'bundle'">
        <div
          *ngFor="let offer of offers"
          class="bundle-item align-items-stretch"
        >
          <ng-container *ngIf="offer">
            <div class="card">
              <div class="card-body d-flex flex-row">
                <div class="bundle-offer-pic p-2">
                  <img
                    style="width: 48px"
                    src="{{ getLogoUrl(offer.service?.id) }}"
                  />
                </div>
                <div class="bundle-offer-desc p-2">
                  <h4 class="card-title">
                    {{ offer.title }}
                  </h4>
                  <div class="provided-by">
                    Service {{ offer.service?.title }}
                  </div>
                  <div class="provided-by">
                    Provided by {{ offer.service?.resource_organisation }}
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
  <div class="bottom-actions">
    <ess-sources
      *ngIf="isResearchProduct"
      class="bottom-action-link"
      [title]="title"
      [urls]="urls"
      [exportData]="exportData"
    ></ess-sources>
    <!-- <ess-share
      [urls]="urls"
      [shareUrl]="validUrl"
      [type]="type"
      class="share-link"
    ></ess-share> -->
    <ess-bibliography
      class="bottom-action-link"
      *ngIf="isResearchProduct"
      [title]="title"
      [hasDOIUrl]="hasDOIUrl"
      [exportData]="exportData"
    ></ess-bibliography>
    <ess-pin
      *ngIf="RESOURCES_TO_SHOW_PIN_TO.includes(type.value)"
      [resourceType]="type.value"
      [resourceId]="id"
      style="border-right: none !important"
      class="bottom-action-link"
    ></ess-pin>
    <ess-pin-static
      *ngIf="
        MP_RESOURCES_TO_SHOW_PIN_TO.includes(type.value) &&
        redirectOrderUrl !== null
      "
      [type]="type.value"
      [url]="redirectOrderUrl"
      style="float: left"
    ></ess-pin-static>
  </div>
  <div *ngIf="type.value === 'provider'">
    <ess-providers-resources [title]="title"></ess-providers-resources>
  </div>
</div>
